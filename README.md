# Django Tree Menu

Это небольшое Django-приложение реализует **древовидное меню**, редактируемое через админку и выводимое через template tag с определением активного пункта по URL и построением всей структуры за один SQL-запрос. Проект реализован в рамках тестового задания от компании "АпТрейдер (UpTrader)".

---

## Содержание

- [1. Запуск проекта](#1-запуск-проекта)
  - [1.1. Запуск через Docker](#11-запуск-через-docker-рекомендуется)
  - [1.2. Локальный запуск без Docker](#12-запуск-локально-без-docker)
- [2. Модели](#2-модели)
  - [2.1. Схема базы данных](#21-схема-базы-данных)
  - [2.2. Menu](#22-menu)
  - [2.3. MenuItem](#23-menuitem)
- [3. Особенности реализации](#3-особенности-реализации)
  - [3.1. Один SQL-запрос](#31-один-sql-запрос)
  - [3.2. Определение активного пункта](#32-определение-активного-пункта)
  - [3.3. Раскрытие веток](#33-раскрытие-веток)
  - [3.4. Пример дерева меню](#34-пример-дерева-меню)
- [4. Внешний вид](#4-внешний-вид)
- [5. Автор](#5-автор)

---

## 1. Запуск проекта

### 1.1. Запуск через Docker (рекомендуется)

#### 1.1.1. Сборка образа

```bash
docker build -t django-menu-app .
```

#### 1.1.2. Запуск контейнера

```bash
docker run -p 8000:8000 django-menu-app
```

Контейнер автоматически выполнит:

- миграции (`migrate`)
- загрузку тестовых данных для заполнения таблицы в БД (`loaddata initial_menu`)
- запуск сервера

> Меню будет полностью готово «из коробки».

Приложение будет доступно по адресу:  
**http://127.0.0.1:8000/** или **http://localhost:8000/**

#### 1.1.3. Создание суперпользователя

Посмотреть запущенные контейнеры:

```bash
docker ps
```

Выполнить команду createsuperuser внутри контейнера:
```bash
docker exec -it <container_id> python manage.py createsuperuser
```

> Где <container_id> — это значение из первой колонки вывода docker ps.

Далее следуйте стандартным вопросам Django: укажите логин, email (можно любой) и пароль.
После этого админка будет доступна по адресу **http://localhost:8000/admin/**

---

### 1.2. Запуск локально (без Docker)

#### 1.2.1. Установка зависимостей
    
```bash
pip install -r requirements.txt
```

#### 1.2.2. Применение миграций

```bash
python manage.py migrate
```

#### 1.2.3. Загрузка тестовых данных

```bash
python manage.py loaddata initial_menu
```

#### 1.2.4. Запуск сервера

```bash
python manage.py runserver
```

#### 1.2.5. Создание суперпользователя

```bash
python manage.py createsuperuser
```

Далее следуйте стандартным вопросам Django: укажите логин, email (можно любой) и пароль.
После этого админка будет доступна по адресу **http://localhost:8000/admin/**

---

## 2. Модели

### 2.1. Схема базы данных
 ![Схема БД](images/menuAppDB.png)

При проектировании базы данных было выделено 2 таблицы: Menu и MenuItem, чтобы поддерживать несколько независимых меню без дублирования пунктов. Данная схема позволяет отрисовать все меню одним SQL-запросом.

sort_order позволяет легко управлять порядком без изменения id или лишних операций.

Поддержка двух типов URL (явных и именованных) дает гибкость при разработке.

---

### 2.2. Menu

| Поле         | Описание             |
|--------------|----------------------|
| name         | Системное имя меню   |
| verbose_name | Отображаемое название|

---

### 2.3. MenuItem

| Поле       | Описание                                     |
|------------|----------------------------------------------|
| menu       | Родительское меню                            |
| title      | Название пункта                              |
| parent     | Родительский пункт (nullable)                |
| url        | Прямой URL                                   |
| named_url  | Имя маршрута (`reverse(...)`)                |
| sort_order | Порядок отображения внутри одного уровня     |

---

## 3. Особенности реализации

### 3.1. Один SQL-запрос

Template tag выполняет только один запрос к БД:

```python
 MenuItem.objects.filter(menu__name=menu_name).select_related('parent', 'menu').order_by('sort_order', 'id')
```

Вся логика сборки дерева и определения активных веток реализована в Python-памяти, без дополнительных обращений к базе.

---

### 3.2. Определение активного пункта

Активность вычисляется по `request.path`.  
Порядок определения URL:

1. Если заполнен `named_url` — используется `reverse(named_url)`.
2. Иначе используется поле `url`.

Все предки активного пункта помечаются как «раскрытые».

---

### 3.3. Раскрытие веток

Согласно условиям задания:

- все **над активным пунктом** раскрывается;
- **первый уровень детей активного пункта** также раскрывается;
- остальные ветки свернуты.

---

### 3.4. Пример дерева меню

```text
main_menu
├── Главная (/)
├── О нас (/about/)
└── Каталог (/catalog/)
    ├── Ноутбуки (/catalog/notebooks/)
    └── Смартфоны (/catalog/phones/)
        └── Apple (/catalog/phones/apple/)
          └── Iphone 16 (/catalog/phones/apple/iphone16)
          └── Iphone 17 (/catalog/phones/apple/iphone17)
          
footer_menu
├── Политика конфиденциальности (confidentiality)
└── Телеграмм создателя (внешняя ссылка)
```

---

## 4. Внешний вид

Меню оформлено через `static/css/style.css`, при необходимости можно его закомментировать в `base.html` (строки 1 и 9)

---

## 5. Автор

**Автор:** *Дарья Односторонцева / telegram: @dariacross*  

---